@startuml dfd-level1
skinparam rectangle {
  BackgroundColor LightYellow
  BorderColor Black
  FontSize 11
  RoundCorner 5
}
skinparam database {
  BackgroundColor LightBlue
  BorderColor Black
  FontSize 10
}
skinparam actor {
  BackgroundColor LightGreen
  BorderColor Black
  FontSize 10
}

title DFD Level 1: Детализация процесса "Оформлять договор аренды" (A33)

' Внешние сущности
actor "Клиент" as Client
actor "Менеджер" as Manager

' Хранилища данных
database "БД\nшаблонов\nдоговоров" as TemplateDB
database "БД\nклиентов" as ClientDB
database "БД\nоборудования" as EquipmentDB
database "Архив\nдоговоров" as Archive

' Подпроцессы Level 1
rectangle "**1.1**\n\nПолучить\nшаблон\nдоговора" as P11
rectangle "**1.2**\n\nЗаполнить\nданные\nдоговора" as P12
rectangle "**1.3**\n\nПроверить\nкорректность\nданных" as P13
rectangle "**1.4**\n\nУтвердить\nдоговор" as P14
rectangle "**1.5**\n\nСохранить\nдоговор" as P15
rectangle "**1.6**\n\nСформировать\nвыходной\nдокумент" as P16

' Входящие потоки
Client -down-> P12 : Данные\nклиента
note on link
  ФИО, паспорт,
  контакты
end note

[Данные бронирования] as Booking
Booking -down-> P12 : Данные\nбронирования
note on link
  Оборудование,
  сроки, стоимость
end note

[Статус оплаты] as PaymentStatus
PaymentStatus -down-> P14 : Статус\nоплаты

' Процесс 1.1: Получить шаблон
TemplateDB --> P11 : Шаблон\nдоговора
P11 --> P12 : Шаблон

' Процесс 1.2: Заполнить данные
ClientDB --> P12 : Профиль\nклиента
EquipmentDB --> P12 : Данные\nоборудования
P12 --> P13 : Черновик\nдоговора

' Процесс 1.3: Проверка
P13 --> P14 : Проверенный\nдоговор
P13 --> P12 : Ошибки\nдля исправления
note on link
  Обратная связь
  при ошибках
end note

' Процесс 1.4: Утверждение
P14 -up-> Manager : Проект\nна утверждение
Manager -down-> P14 : Решение\nменеджера
P14 --> P15 : Утвержденный\nдоговор

' Процесс 1.5: Сохранение
P15 --> Archive : Данные\nдоговора
P15 --> P16 : Договор\nдля выдачи

' Процесс 1.6: Формирование документа
P16 -up-> Client : Договор\nаренды

@enduml
