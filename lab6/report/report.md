---
title: "Практическая работа № 7"
subtitle: "Проектирование структуры данных информационной системы и создание ER-диаграммы"
author: "Грибков Александр Андреевич"
date: "2025"
lang: ru-RU
toc: true
toc-title: "Содержание"
numbersections: true
geometry: margin=2cm
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: article
header-includes:
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhead[L]{Лабораторная работа № 7}
  - \fancyhead[R]{ER-диаграмма}
  - \usepackage{longtable}
  - \usepackage{booktabs}
---

# Практическая работа № 7. Проектирование структуры данных информационной системы и создание ER-диаграммы

## Цель работы

Создание модели «сущность-связь» в нотации ERD для информационной системы SportRent (система управления прокатом спортивного оборудования).

## Теоретическая часть

### Основные понятия

**База данных (БД)** — важнейший компонент информационной системы, представляющий собой набор данных, структурированный особым образом в рамках выбранной модели.

**Модель данных** — это концептуальное представление данных (в частности сущностей и связей между ними) в проектируемой БД, выраженное графически (в виде схемы) и/или описательно (текстовое представление).

Наиболее часто для описания модели данных используют **семантическое моделирование** с применением диаграмм «сущность-связь» (Entity-Relationship Diagram, ERD).

### Основные элементы ER-диаграмм

**Сущность (Entity)** — объект диаграммы entity-relation, описывающий или представляющий некоторые объекты или наборы объектов, как реальных, так и абстрактных. Сущности представляются в виде прямоугольников с названием внутри (в единственном числе, именительном падеже).

**Экземпляр сущности** — конкретный представитель сущности. Также используются термины: «запись» и «кортеж».

**Атрибут сущности** — признак или характеристика, используемые для выделения объекта в сущность.

**Связь (Relationship)** — определенная ассоциация (или соответствие, взаимозависимость) между двумя сущностями. Связь может соединять не только две сущности, но и сущность «саму с собой».

### Типы связей

**Один-к-одному (1:1)** — только одна запись первой сущности связана только с одной записью в другой сущности.

**Один-ко-многим (1:N)** — несколько строк из дочерней таблицы зависят от одной строки в родительской таблице. Наиболее часто встречающийся тип связи.

**Многие-ко-многим (M:N)** — множественным записям из одной таблицы соответствуют множественные записи из другой таблицы. На практике не рекомендуется использовать напрямую, разрешается через промежуточную таблицу.

### Нормализация базы данных

**Первая нормальная форма (1НФ)** — все атрибуты атомарны, отсутствуют повторяющиеся группы.

**Вторая нормальная форма (2НФ)** — соответствие 1НФ + все неключевые атрибуты полностью функционально зависят от первичного ключа.

**Третья нормальная форма (3НФ)** — соответствие 2НФ + отсутствие транзитивных зависимостей между неключевыми атрибутами.

## Практическая часть

### План разработки модели базы данных

Проектирование базы данных системы SportRent выполнено в следующей последовательности:

1. **Анализ предметной области** — изучение функциональных требований, бизнес-процессов и ролей пользователей
2. **Анализ функциональной модели IDEF0** — изучение диаграмм из Лабораторных работ 3-4
3. **Анализ потоков данных DFD** — изучение диаграмм из Лабораторной работы 5
4. **Выявление сущностей и атрибутов** — определение информационных объектов и их характеристик
5. **Установление связей между сущностями** — определение типов связей и внешних ключей
6. **Построение концептуальной ER-диаграммы** — создание визуального представления модели
7. **Нормализация структуры БД** — проверка соответствия 1НФ, 2НФ, 3НФ
8. **Проверка корректности** — создание типовых SQL-запросов

### Анализ предметной области

**SportRent** — автоматизированная информационная система управления прокатом спортивного оборудования. Система предназначена для автоматизации процессов бронирования и аренды, ведения каталога оборудования, управления взаимоотношениями с клиентами, обработки платежей, учета складских операций и формирования отчетности.

#### Основные роли пользователей

Из анализа IDEF0-диаграмм выявлены следующие роли:

- **Клиент (Client)** — конечный пользователь, арендующий оборудование
- **Менеджер (Manager)** — сотрудник, обрабатывающий заказы и утверждающий договоры
- **Администратор (Administrator)** — системный администратор с полным доступом
- **Складской персонал (Warehouse Staff)** — сотрудники, выполняющие выдачу и прием оборудования

#### Функциональные модули

Из декомпозиции IDEF0 выделены следующие модули:

- **A1**: Управление аутентификацией и профилями клиентов
- **A2**: Управление каталогом оборудования
- **A3**: Обработка бронирования и заказов
- **A4**: Обработка платежей
- **A5**: Управление складскими операциями
- **A6**: Формирование отчетности

#### Хранилища данных

Из анализа DFD-диаграмм выявлены следующие хранилища:

- **БД клиентов (ClientDB)** — персональные данные, история аренды
- **БД оборудования (EquipmentDB)** — каталог, характеристики, доступность
- **БД шаблонов договоров (TemplateDB)** — юридические шаблоны
- **Архив договоров (Archive)** — подписанные договоры с метаданными

### Выявление сущностей базы данных

Для определения сущностей использовался метод анализа существительных из описания предметной области, функциональной модели IDEF0, диаграмм потоков данных DFD и хранилищ данных.

В результате анализа выявлено **16 основных сущностей**, сгруппированных в 7 функциональных блоков:

**Группа 1: Пользователи и участники системы**

1. **Client (Клиент)** — физические и юридические лица, арендующие оборудование
2. **User (Пользователь)** — учетные записи для аутентификации в системе
3. **Employee (Сотрудник)** — персонал компании

**Группа 2: Оборудование и каталог**

4. **EquipmentCategory (Категория оборудования)** — иерархическая классификация
5. **Equipment (Оборудование)** — типы оборудования в каталоге
6. **EquipmentItem (Единица оборудования)** — конкретные экземпляры с серийными номерами

**Группа 3: Бронирование и заказы**

7. **Booking (Бронирование)** — предварительные резервации оборудования
8. **Order (Заказ)** — подтвержденные заказы на аренду
9. **OrderItem (Позиция заказа)** — конкретные единицы оборудования в заказе

**Группа 4: Договоры**

10. **ContractTemplate (Шаблон договора)** — юридические шаблоны
11. **Contract (Договор)** — юридические договоры аренды

**Группа 5: Финансы**

12. **Payment (Платеж)** — информация о платежах и транзакциях

**Группа 6: Складские операции**

13. **RentalTransaction (Выдача/Возврат)** — операции выдачи и приема оборудования
14. **Maintenance (Техническое обслуживание)** — ремонт и профилактика

**Группа 7: Система и отчетность**

15. **Report (Отчет)** — сохраненные отчеты и аналитика
16. **Notification (Уведомление)** — системные уведомления

### Описание основных сущностей

#### Client (Клиент)

**Назначение:** Хранение информации о клиентах системы — как физических, так и юридических лиц.

**Основные атрибуты:**

- `client_id` (PK, INTEGER) — уникальный идентификатор клиента
- `first_name`, `last_name`, `middle_name` (VARCHAR) — ФИО
- `passport_series`, `passport_number` (VARCHAR) — паспортные данные
- `phone`, `email` (VARCHAR, UNIQUE) — контактная информация
- `client_type` (VARCHAR) — тип: Individual / Organization
- `is_active` (BOOLEAN) — активность учетной записи

#### Equipment (Оборудование)

**Назначение:** Каталог типов спортивного оборудования, доступного для аренды.

**Основные атрибуты:**

- `equipment_id` (PK, INTEGER) — уникальный идентификатор
- `category_id` (FK, INTEGER) — категория оборудования
- `name`, `description` (VARCHAR, TEXT) — название и описание
- `brand`, `model` (VARCHAR) — производитель и модель
- `daily_rate`, `hourly_rate` (DECIMAL) — стоимость аренды
- `deposit_amount` (DECIMAL) — сумма залога
- `quantity_total`, `quantity_available` (INTEGER) — количество

#### Order (Заказ)

**Назначение:** Подтвержденные заказы на аренду оборудования.

**Основные атрибуты:**

- `order_id` (PK, INTEGER) — уникальный идентификатор
- `client_id` (FK, INTEGER) — клиент
- `manager_id` (FK, INTEGER) — менеджер
- `start_date`, `end_date` (DATE) — даты аренды
- `subtotal`, `deposit`, `total_amount` (DECIMAL) — суммы
- `status` (VARCHAR) — статус заказа

#### Contract (Договор)

**Назначение:** Юридические договоры аренды между клиентом и компанией.

**Основные атрибуты:**

- `contract_id` (PK, INTEGER) — уникальный идентификатор
- `order_id` (FK, INTEGER) — связанный заказ
- `contract_number` (VARCHAR, UNIQUE) — номер договора
- `contract_date`, `start_date`, `end_date` (DATE) — даты
- `status` (VARCHAR) — статус договора
- `digital_signature_client`, `digital_signature_manager` (TEXT) — ЭЦП

### Описание связей между сущностями

#### Связи типа "один-ко-многим" (1:N)

Основные связи:

- **Client → Order** — один клиент имеет много заказов
- **Client → Booking** — один клиент создает много бронирований
- **Client → Contract** — один клиент подписывает много договоров
- **Employee → Order** — один менеджер обрабатывает много заказов
- **EquipmentCategory → Equipment** — одна категория содержит много типов оборудования
- **Equipment → EquipmentItem** — один тип имеет много экземпляров
- **Order → OrderItem** — один заказ содержит много позиций
- **Order → Payment** — один заказ имеет много платежей
- **EquipmentItem → RentalTransaction** — одна единица в многих операциях выдачи/возврата

#### Связи типа "один-к-одному" (1:1)

- **User → Client** — учетная запись может принадлежать клиенту (опциональная)
- **User → Employee** — учетная запись может принадлежать сотруднику (опциональная)
- **Booking → Order** — бронирование преобразуется в заказ (опциональная)
- **Order → Contract** — заказ может иметь договор (опциональная)

#### Рекурсивные связи

- **EquipmentCategory → EquipmentCategory** — иерархия категорий через `parent_category_id`

#### Связи типа "многие-ко-многим" (M:N)

Все связи M:N разрешены через промежуточные таблицы:

- **Order ↔ EquipmentItem** через **OrderItem** — заказ содержит много единиц оборудования

### ER-диаграмма системы SportRent

![ER-диаграмма системы SportRent](../solutions/diagrams/er-diagram.png)

На диаграмме представлены все 16 сущностей с полным набором атрибутов, первичными и внешними ключами, а также связями между ними.

**Условные обозначения:**

- **PK (Primary Key)** — первичный ключ, выделен жирным шрифтом
- **FK (Foreign Key)** — внешний ключ, выделен зеленым цветом
- **Обычные атрибуты** — выделены синим цветом
- **||--o{** — связь "один-ко-многим" (обязательная)
- **}o--||** — связь "многие-к-одному"
- **||--o|** — связь "один-к-одному" (опциональная)

### Проверка корректности модели с помощью SQL

#### Пример 1: Получить список доступных велосипедов

```sql
SELECT
    e.equipment_id,
    e.name,
    e.brand,
    e.model,
    e.daily_rate,
    e.quantity_available,
    c.category_name
FROM Equipment e
INNER JOIN EquipmentCategory c ON e.category_id = c.category_id
WHERE c.category_name LIKE '%Велосипед%'
  AND e.is_active = TRUE
  AND e.quantity_available > 0
ORDER BY e.daily_rate ASC;
```

**Цель:** Проверить связь Equipment ↔ EquipmentCategory.

#### Пример 2: Получить информацию о заказе с деталями

```sql
SELECT
    o.order_id,
    o.order_date,
    c.first_name || ' ' || c.last_name AS client_name,
    e.name AS equipment_name,
    oi.quantity,
    oi.daily_rate,
    oi.rental_days,
    oi.item_subtotal
FROM "Order" o
INNER JOIN Client c ON o.client_id = c.client_id
INNER JOIN OrderItem oi ON o.order_id = oi.order_id
INNER JOIN Equipment e ON oi.equipment_id = e.equipment_id
WHERE o.order_id = 12345;
```

**Цель:** Проверить цепочку связей Order → OrderItem → Equipment → Client.

#### Пример 3: Найти оборудование, требующее ТО

```sql
SELECT
    ei.item_id,
    ei.serial_number,
    e.name,
    e.brand,
    ei.next_maintenance_date
FROM EquipmentItem ei
INNER JOIN Equipment e ON ei.equipment_id = e.equipment_id
WHERE ei.next_maintenance_date <= CURRENT_DATE + INTERVAL '7 days'
  AND ei.status NOT IN ('Broken', 'Lost')
ORDER BY ei.next_maintenance_date ASC;
```

**Цель:** Проверить связь EquipmentItem ↔ Equipment и работу с датами.

#### Пример 4: Получить информацию о договоре

```sql
SELECT
    ct.contract_id,
    ct.contract_number,
    ct.contract_date,
    c.first_name || ' ' || c.last_name AS client_name,
    e.first_name || ' ' || e.last_name AS manager_name,
    o.order_id,
    o.total_amount
FROM Contract ct
INNER JOIN Client c ON ct.client_id = c.client_id
INNER JOIN Employee e ON ct.manager_id = e.employee_id
INNER JOIN "Order" o ON ct.order_id = o.order_id
WHERE ct.contract_id = 5001;
```

**Цель:** Проверить связь Contract ↔ Client, Employee, Order.

#### Пример 5: Статистика использования оборудования

```sql
SELECT
    e.equipment_id,
    e.name,
    e.brand,
    COUNT(DISTINCT o.order_id) AS total_orders,
    SUM(oi.item_subtotal) AS total_revenue
FROM Equipment e
LEFT JOIN OrderItem oi ON e.equipment_id = oi.equipment_id
LEFT JOIN "Order" o ON oi.order_id = o.order_id
WHERE o.status IN ('Completed', 'Active')
GROUP BY e.equipment_id, e.name, e.brand
ORDER BY total_revenue DESC
LIMIT 10;
```

**Цель:** Проверить агрегацию данных и связь Equipment → OrderItem → Order.

### Нормализация базы данных

#### Первая нормальная форма (1НФ)

✅ Все таблицы соответствуют 1НФ. Все атрибуты атомарны, отсутствуют повторяющиеся группы.

❗ Исключения: атрибуты `image_urls`, `technical_specs`, `report_data` используют тип JSON для хранения гибких структур данных (допустимо в современных СУБД PostgreSQL/MySQL).

#### Вторая нормальная форма (2НФ)

✅ Во всех таблицах используются суррогатные первичные ключи (SERIAL), все атрибуты зависят от полного ключа. Нет частичных зависимостей от составных ключей.

#### Третья нормальная форма (3НФ)

✅ Транзитивные зависимости устранены за счет декомпозиции:

- Информация о типе оборудования (Equipment) отделена от конкретных единиц (EquipmentItem)
- Шаблоны договоров (ContractTemplate) отделены от самих договоров (Contract)
- Клиенты (Client) отделены от пользователей (User)

## Ответы на контрольные вопросы

### 1. Что такое база данных информационной системы?

База данных (БД) информационной системы — это организованная совокупность структурированных данных, хранящихся в электронном виде и предназначенных для многократного использования множеством приложений и пользователей.

### 2. Что такое модель данных?

Модель данных — это концептуальное представление данных (в частности, сущностей и связей между ними) в проектируемой БД, выраженное графически (в виде диаграмм) и/или описательно (текстовое представление).

### 3. Что такое «сущность» в рамках ERD-моделирования?

Сущность (Entity) — это объект реального или абстрактного мира, информация о котором подлежит хранению в базе данных. Сущность представляет собой класс однотипных объектов, обладающих общими характеристиками.

### 4. Что такое «связь» в рамках ERD-моделирования?

Связь (Relationship) — это определенная ассоциация (соответствие, взаимозависимость) между двумя или более сущностями, описывающая, каким образом сущности взаимодействуют друг с другом.

### 5. Какую роль играет ER-диаграмма в проекте информационной системы?

ER-диаграмма играет ключевую роль: обеспечивает визуализацию структуры данных, служит технической документацией, используется для генерации SQL-скриптов, обеспечивает единое понимание модели данных всеми участниками проекта.

### 6. Какую задачу надо решить в процессе выполнения работы?

Необходимо решить задачу анализа модели потоков данных (DFD) и формирования на её основе концептуальной ER-диаграммы для информационной системы SportRent.

### 7. В каком аспекте рассматривается БД?

БД рассматривается как составная часть проектируемой информационной системы, обеспечивающая хранение и управление данными для всех функциональных модулей.

### 8. Каким образом определяются сущности?

Сущности определяются методом анализа существительных из описания предметной области, изучения хранилищ данных на DFD-диаграммах, анализа функциональной модели IDEF0 и группировки объектов по характерным признакам.

### 9. Кто предложил наиболее используемую нотацию ERD?

Наиболее часто используемую нотацию ERD-моделирования предложил Гордон Эверест (Gordon Everest). Также широко используется нотация Питера Чена (Peter Chen).

### 10. Что такое «экземпляр сущности»?

Экземпляр сущности (Entity Instance) — это конкретный представитель сущности, то есть одна конкретная запись в таблице базы данных с определенными значениями атрибутов.

### 11. Каков принцип группировки объектов в общую сущность ERD?

Объекты группируются в сущность, если обладают общим набором атрибутов, играют одинаковую роль в предметной области, участвуют в аналогичных бизнес-процессах и подчиняются одним бизнес-правилам.

### 12. Какие элементы входят в модель ERD?

В модель ERD входят: сущности, атрибуты, первичные и внешние ключи, связи, кардинальность связей, опциональность, типы данных.

### 13. Какие CASE-средства рекомендованы?

Рекомендованы: draw.io (diagrams.net), dbdiagram.io, MySQL Workbench, pgModeler, PlantUML, ERwin Data Modeler, Microsoft Visio.

### 14. Какие типы связей доступны?

Доступны типы связей: один-к-одному (1:1), один-ко-многим (1:N), многие-ко-многим (M:N), рекурсивная связь, опциональная и обязательная связи.

### 15. Правила связей один-ко-многим

**Правила:** Одна запись родительской таблицы связана с несколькими записями дочерней таблицы. В дочерней таблице создается внешний ключ.

**Пример:** Client → Order — один клиент может иметь много заказов.

### 16. Правила связей один-к-одному

**Правила:** Одна запись первой таблицы связана только с одной записью второй таблицы. Внешний ключ должен быть уникальным.

**Пример:** Order → Contract — один заказ может иметь один договор.

### 17. Правила связей многие-ко-многим

**Правила:** На практике не рекомендуется использовать напрямую, разрешается через промежуточную таблицу с двумя внешними ключами.

**Пример:** Order ↔ EquipmentItem через OrderItem — заказ содержит много единиц оборудования, которые могут участвовать в разных заказах.

## Выводы

В ходе выполнения лабораторной работы была разработана концептуальная модель базы данных информационной системы SportRent в виде ER-диаграммы.

**Основные результаты:**

1. Проведен комплексный анализ предметной области на основе функциональных моделей IDEF0 и диаграмм потоков данных DFD.

2. Выявлено 16 основных сущностей, сгруппированных в 7 функциональных блоков: пользователи, оборудование, заказы, договоры, финансы, склад, система.

3. Определено более 20 связей различных типов между сущностями.

4. Создана ER-диаграмма с полным описанием атрибутов, первичных и внешних ключей.

5. Проверена корректность модели с помощью типовых SQL-запросов.

6. Выполнена нормализация структуры БД до третьей нормальной формы (3НФ).

7. Модель соответствует требованиям системы SportRent по автоматизации процессов аренды.

**Практическая значимость:**

Разработанная ER-диаграмма служит основой для физического проектирования базы данных, генерации SQL-скриптов, документирования структуры данных и разработки API приложения.

Модель готова к использованию на следующих этапах разработки информационной системы SportRent.
